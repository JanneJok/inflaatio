const CONFIG={SHEET_ID:"1tj7AbW3BkzmPZUd_pfrXmaHZrgpKgYwNljSoVoAObx8",API_KEY:"AIzaSyDbeAW-uO-vEHuPdSJPVQwR_l1Axc7Cq7g",HISTORICAL_RANGE:"Raakadata!A:F",METRICS_RANGE:"Key Metrics!A:B",CACHE_DURATION:3e5},EMAILJS_CONFIG={SERVICE_ID:"service_nnxux1e",TEMPLATE_ID:"template_evci98f",PUBLIC_KEY:"EV6UX6GIPG231yXUd"},SUPABASE_CONFIG={URL:"https://ysuhexvvgjoizrcdrxso.supabase.co",ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlzdWhleHZ2Z2pvaXpyY2RyeHNvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MDQzODksImV4cCI6MjA3ODE4MDM4OX0.0UFYz-xd_QmUEdVcKWqRo6D4QcwvAmlKDKSdu7M4ENA"},supabase=(()=>{const t={apikey:SUPABASE_CONFIG.ANON_KEY,Authorization:`Bearer ${SUPABASE_CONFIG.ANON_KEY}`,"Content-Type":"application/json"};return{from:e=>({insert:async a=>{try{const n=await fetch(`${SUPABASE_CONFIG.URL}/rest/v1/${e}`,{method:"POST",headers:t,body:JSON.stringify(a)});return{error:n.ok?null:await n.json()}}catch(t){return{error:t}}},select:async(a="*")=>{try{const n=await fetch(`${SUPABASE_CONFIG.URL}/rest/v1/${e}?select=${a}`,{method:"GET",headers:t}),o=await n.json();return{data:n.ok?o:null,error:n.ok?null:o}}catch(t){return{data:null,error:t}}}})}})(),Analytics=window.Analytics={pageLoadTime:Date.now(),async track(t,e={}){try{const a=(new Date).toISOString().split("T")[0],n=window.location.pathname,o=document.referrer?new URL(document.referrer).hostname:"direct",i=new URLSearchParams(window.location.search),r={date:a,event_type:t,page:n,referrer:o,search_query:i.get("q")||i.get("search")||i.get("query")||i.get("s")||i.get("utm_term")||null,count:1};"session_end"===t&&e.duration&&(r.session_duration=Math.round(e.duration));const{error:l}=await supabase.from("inflaatio_analytics").insert(r);l&&console.error("Analytics error:",l)}catch(t){console.debug("Analytics tracking failed:",t)}},pageView(){this.track("page_view"),this.startSessionTracking()},startSessionTracking(){this.pageLoadTime=Date.now();let t=0;const trackSessionEnd=(e=!1)=>{const a=(Date.now()-this.pageLoadTime)/1e3;if(a>3&&a-t>=2){t=a;const n={date:(new Date).toISOString().split("T")[0],event_type:"session_end",page:window.location.pathname,referrer:document.referrer?new URL(document.referrer).hostname:"direct",search_query:null,count:1,session_duration:Math.round(a)};e?fetch(`${SUPABASE_CONFIG.URL}/rest/v1/inflaatio_analytics`,{method:"POST",headers:{apikey:SUPABASE_CONFIG.ANON_KEY,Authorization:`Bearer ${SUPABASE_CONFIG.ANON_KEY}`,"Content-Type":"application/json",Prefer:"return=minimal"},body:JSON.stringify(n),keepalive:!0}).catch(()=>{}):supabase.from("inflaatio_analytics").insert(n)}},e=setInterval(()=>{document.hidden||trackSessionEnd(!1)},5e3);window.addEventListener("beforeunload",()=>{clearInterval(e),trackSessionEnd(!0)}),window.addEventListener("pagehide",()=>{clearInterval(e),trackSessionEnd(!0)}),document.addEventListener("visibilitychange",()=>{document.hidden&&trackSessionEnd(!0)})},chartInteraction(t){this.track("chart_interaction",{chart:t})},contactForm(){this.track("contact_form")},cookieAccept(){this.track("cookie_accept")},cookieDecline(){this.track("cookie_decline")}};let inflationData=[],cpiData=[],keyMetrics={},dataCache=new Map,lastFetch=0;async function handleContactSubmit(t){t.preventDefault();const e=t.target,a=e.querySelector(".submit-btn"),n=a.querySelector(".btn-text"),o=a.querySelector(".btn-loading"),i=document.getElementById("contactSuccess"),r=new FormData(e),l=r.get("userName").trim(),s=r.get("userEmail").trim(),c=r.get("userMessage").trim();if(l&&s&&c){a.disabled=!0,n.style.display="none",o.style.display="inline";try{const t={from_name:l,from_email:s,message:c,reply_to:s};await emailjs.send(EMAILJS_CONFIG.SERVICE_ID,EMAILJS_CONFIG.TEMPLATE_ID,t),Analytics.contactForm(),e.style.display="none",i.style.display="block";const a=document.getElementById("contact-prompt");a&&(a.style.display="none")}catch(t){console.error("Virhe viestin lÃ¤hetyksessÃ¤:",t),alert("Viestin lÃ¤hetyksessÃ¤ tapahtui virhe. YritÃ¤ uudelleen."),a.disabled=!1,n.style.display="inline",o.style.display="none"}}else alert("TÃ¤ytÃ¤ kaikki vaaditut kentÃ¤t.")}document.addEventListener("DOMContentLoaded",()=>{function initEmailJS(){"undefined"==typeof emailjs||window.emailJsInitialized||(emailjs.init(EMAILJS_CONFIG.PUBLIC_KEY),window.emailJsInitialized=!0)}Analytics.pageView(),initEmailJS();const t=setInterval(()=>{"undefined"!=typeof emailjs&&(initEmailJS(),clearInterval(t))},100);let e=null,a=null,n=null,o=null,i="cpi",r="cpi";const l=document.querySelector(".carousel-inner"),s=document.querySelector(".arrow-left"),c=document.querySelector(".arrow-right");l&&s&&c&&(s.addEventListener("click",()=>{l.scrollBy({left:-330,behavior:"smooth"})}),c.addEventListener("click",()=>{l.scrollBy({left:330,behavior:"smooth"})})),document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(t){t.preventDefault();const e=document.querySelector(this.getAttribute("href"));e&&e.scrollIntoView({behavior:"smooth",block:"start"})})});const d=document.getElementById("contactModal"),u=document.getElementById("contactModalBtn"),h=document.getElementById("modalClose"),p=document.getElementById("modalOverlay"),g=document.getElementById("contactForm");function closeModal(){d&&(d.classList.remove("show"),setTimeout(()=>{d.style.display="none",document.body.style.overflow="",function resetContactForm(){const t=document.getElementById("contactForm"),e=document.getElementById("contactSuccess");if(t&&e){t.style.display="block",t.reset(),e.style.display="none";const a=t.querySelector(".submit-btn"),n=a?a.querySelector(".btn-text"):null,o=a?a.querySelector(".btn-loading"):null;a&&(a.disabled=!1,n&&(n.style.display="inline"),o&&(o.style.display="none"))}}()},300))}function getRangeMonths(t){switch(t){case"6kk":return 6;case"1v":return 12;case"3v":return 36;case"5v":default:return 60;case"Max":return 9999}}function updateInflationStats(t){const e="cpi"===i?cpiData:inflationData;if(!e||0===e.length)return void console.log("No data available for stats calculation");const a=getRangeMonths(t),n=Math.max(0,e.length-a),o=function calculateInflationStats(t){if(!t||!t.length)return{min:0,max:0,avg:0};const e=t.map(t=>t.inflation).filter(t=>!isNaN(t));if(0===e.length)return{min:0,max:0,avg:0};const a=Math.min(...e),n=Math.max(...e),o=e.reduce((t,e)=>t+e,0)/e.length;return{min:a.toFixed(1),max:n.toFixed(1),avg:o.toFixed(1)}}(e.slice(n)),r=document.querySelector("#analytiikka .chart:first-child .chart-stats");r&&(r.innerHTML=`\n                <p><span class="percentage-badge">ğŸ”µ</span> Minimi ${o.min}%</p>\n                <p><span class="percentage-badge">ğŸŸ¡</span> Keskiarvo ${o.avg}%</p>\n                <p><span class="percentage-badge">ğŸ”´</span> Maksimi ${o.max}%</p>\n            `),console.log("ğŸ“Š Inflation stats updated for range:",t,o)}function updateHicpStats(t){const e="cpi"===r?cpiData:inflationData,a="cpi"===r?"cpi":"hicp";if(!e||0===e.length)return void console.log("No data available for stats calculation");const n=getRangeMonths(t),o=Math.max(0,e.length-n),i=function calculateHicpStats(t,e,a){if(!(t&&t.length&&e&&e.length))return{growthRate:0,indexValue:0,yearlyChange:0,yearlyChangeLabel:"viimeisen 12kk vuosimuutos",indexLabel:"viimeisin Indeksiarvo"};const n=e[e.length-1][a],o=t[0][a],i=t[t.length-1][a],r=t.length;let l=0;r>0&&o>0&&(l=(i-o)/o*100/r*12);let s=0;if(e.length>=13){const t=e[e.length-13][a];t>0&&(s=(n-t)/t*100)}return{growthRate:l.toFixed(1),indexValue:n.toFixed(2),yearlyChange:s.toFixed(1),yearlyChangeLabel:"viimeisen 12kk vuosimuutos",indexLabel:"viimeisin Indeksiarvo"}}(e.slice(o),e,a),l=document.querySelector("#analytiikka .chart:last-child .chart-stats");if(l){const t=i.yearlyChange>=0?"+":"",e=i.growthRate>=0?"+":"";l.innerHTML=`\n                <p><span class="percentage-badge">ğŸ“ˆ</span> Nousutahti ${e}${i.growthRate}%</p>\n                <p><span class="percentage-badge">ğŸ“Š</span> ${i.indexLabel} ${i.indexValue}</p>\n                <p><span class="percentage-badge">ğŸ“…</span> ${i.yearlyChangeLabel} ${t}${i.yearlyChange}%</p>\n            `}console.log("ğŸ“ˆ Index stats updated for range:",t,i)}function updateChart(t,e,a){if(!t||!e)return void console.log("Chart or data not available for update");const n=function filterDataByRange(t,e){if(!t||!t.labels||!t.datasets)return console.log("No data available to filter"),null;const a=t.labels.length;let n;switch(e){case"6kk":n=Math.min(6,a);break;case"1v":n=Math.min(12,a);break;case"3v":n=Math.min(36,a);break;case"5v":n=Math.min(60,a);break;default:n=a}const o=Math.max(0,a-n);return{labels:t.labels.slice(o),datasets:t.datasets.map(t=>({...t,data:t.data.slice(o)}))}}(e,a);n&&(t.data=n,t.update("none"))}u&&u.addEventListener("click",function(t){t.preventDefault(),function openModal(){d&&(d.style.display="flex",setTimeout(()=>{d.classList.add("show")},10),document.body.style.overflow="hidden")}()}),h&&h.addEventListener("click",closeModal),p&&p.addEventListener("click",closeModal),document.addEventListener("keydown",function(t){"Escape"===t.key&&d&&d.classList.contains("show")&&closeModal()}),g&&g.addEventListener("submit",handleContactSubmit);const f=document.querySelector("#analytiikka .chart:first-child .chart-controls");f&&f.querySelectorAll("button").forEach(t=>{t.addEventListener("click",function(){this.parentElement.querySelectorAll("button[data-range]").forEach(t=>{t.classList.remove("active")}),this.classList.add("active");const t=this.textContent;console.log("ğŸ“Š Inflation chart range changed to:",t),Analytics.chartInteraction("inflation_"+t),e&&n?(updateChart(e,n,t),updateInflationStats(t)):console.log("Waiting for inflation data from Google Sheets...")})});const y=document.querySelector("#analytiikka .chart:last-child .chart-controls");async function fetchThroughProxy(t){try{const e=`https://sheets.googleapis.com/v4/spreadsheets/${CONFIG.SHEET_ID}/values/${encodeURIComponent(t)}?key=${CONFIG.API_KEY}`;console.log(`ğŸ“„ Fetching directly from Google Sheets: ${t}`);const a=await fetch(e);if(!a.ok)throw new Error(`Google Sheets API error: ${a.status}`);return(await a.json()).values||[]}catch(e){throw console.error(`Error fetching range ${t}:`,e),e}}async function fetchInflationData(){if(window.STATIC_DATA_AVAILABLE&&"undefined"!=typeof STATIC_INFLATION_DATA)return console.log("âœ… Using static inline data (no API calls)"),inflationData=STATIC_INFLATION_DATA.map(t=>({date:t[0],inflation:t[1],hicp:t[2]||0})),"undefined"!=typeof STATIC_CPI_DATA&&(cpiData=STATIC_CPI_DATA.map(t=>({date:t[0],inflation:t[1],cpi:t[2]||0})),console.log(`ğŸ“Š Loaded ${cpiData.length} CPI data points from static data`)),console.log(`ğŸ“Š Loaded ${inflationData.length} HICP data points from static data`),updateYearlyTable(),updateKeyMetrics(),updateInfoBanner(),updateChartsWithData(),{historical:inflationData,cpi:cpiData,metrics:{}};const t="inflation_data",e=Date.now();if(dataCache.has(t)&&e-lastFetch<CONFIG.CACHE_DURATION){const e=dataCache.get(t);return inflationData=e.historical||[],keyMetrics=e.metrics||{},updateChartsWithData(),e}try{console.log("ğŸ“„ Fetching data through secure proxy (fallback mode)...");const[a,n]=await Promise.all([fetchThroughProxy(CONFIG.HISTORICAL_RANGE),fetchThroughProxy(CONFIG.METRICS_RANGE)]);a?.length>1&&(inflationData=function processHistoricalData(t){const e=t[0],a=t.slice(1),n=e.indexOf("Kuukausi"),o=e.indexOf("Inflaatio %"),i=e.indexOf("Indeksi"),r=a.map(t=>{const e=t[n]||"",a=t[o]||"",r=t[i]||"",l=parseFloat(a.replace("%","").replace(",",".").trim()),s=parseFloat(r.replace(",",".").trim());return{date:e,inflation:isNaN(l)?0:l,hicp:isNaN(s)?0:s}}).filter(t=>t.date&&!isNaN(t.inflation)),l=r.sort((t,e)=>new Date(t.date+"-01")-new Date(e.date+"-01"));return l}(a)),n?.length>1&&(keyMetrics=function processKeyMetrics(t){const e={};return t.slice(1).forEach(t=>{if(t.length>=2&&t[0]&&t[1]){const a=t[0].toString().trim(),n=t[1].toString().trim();e[a]=n}}),e}(n),function updateTiles(){if(!keyMetrics||0===Object.keys(keyMetrics).length)return;const t=document.querySelectorAll(".tile .highlight"),e=Object.keys(keyMetrics);t.forEach((t,a)=>{if(a<e.length){const n=keyMetrics[e[a]];if(t.textContent=n,"string"==typeof n&&n.includes("%")){const e=parseFloat(n.replace("%","").replace(",","."));isNaN(e)||(t.className=e>0?"highlight positive":e<0?"highlight negative":"highlight neutral")}}})}());const o={historical:inflationData,metrics:keyMetrics};return dataCache.set(t,o),lastFetch=e,updateChartsWithData(),updateYearlyTable(),updateKeyMetrics(),updateInfoBanner(),console.log("âœ… Data loaded successfully through proxy"),o}catch(t){return console.error("âŒ Data fetch error:",t),function showErrorMessage(t){const e=document.createElement("div");e.className="error-message",e.textContent=t,e.style.cssText="\n            position: fixed;\n            top: 100px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: rgba(239, 68, 68, 0.9);\n            color: white;\n            padding: 1rem 2rem;\n            border-radius: 8px;\n            z-index: 1001;\n            backdrop-filter: blur(10px);\n        ",document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},5e3)}("Tietojen lataaminen epÃ¤onnistui. Tarkista verkkoyhteytesi."),null}}y&&y.querySelectorAll("button").forEach(t=>{t.addEventListener("click",function(){this.parentElement.querySelectorAll("button[data-range]").forEach(t=>{t.classList.remove("active")}),this.classList.add("active");const t=this.textContent;console.log("ğŸ“ˆ HICP chart range changed to:",t),Analytics.chartInteraction("hicp_"+t),a&&o?(updateChart(a,o,t),updateHicpStats(t)):console.log("Waiting for HICP data from Google Sheets...")})}),document.querySelectorAll(".chart-controls").forEach((t,e)=>{const a=document.createElement("div");a.className="data-source-toggle",a.dataset.chart=0===e?"inflation":"index",a.style.cssText="display: inline-flex; gap: 6px; margin-right: 15px; padding-right: 15px; border-right: 1px solid rgba(255,255,255,0.2);";const n=document.createElement("button");n.textContent="CPI",n.dataset.source="cpi",n.className="active",n.style.cssText="background: rgba(76, 165, 186, 0.2);";const o=document.createElement("button");o.textContent="HICP",o.dataset.source="hicp",o.style.cssText="background: rgba(255, 153, 51, 0.2);",a.appendChild(n),a.appendChild(o),t.insertBefore(a,t.firstChild)}),document.querySelectorAll(".data-source-toggle button").forEach(t=>{t.addEventListener("click",function(){this.parentElement.querySelectorAll("button").forEach(t=>{t.classList.remove("active")}),this.classList.add("active");const t=this.closest(".data-source-toggle").dataset.chart;"inflation"===t?(i=this.dataset.source,Analytics.chartInteraction("inflation_source_"+this.dataset.source),updateInflationChart()):(r=this.dataset.source,Analytics.chartInteraction("index_source_"+this.dataset.source),updateIndexChart()),console.log("ğŸ“Š Data source changed for",t,":",this.dataset.source)})}),document.querySelectorAll(".chart-controls").forEach(t=>{const e=Array.from(t.querySelectorAll("button[data-range]")).find(t=>"5v"===t.textContent);e&&e.classList.add("active")}),window.initCharts=function(){window.chartsInitialized?console.log("âš ï¸ Charts already initialized, skipping..."):"undefined"!=typeof Chart?(console.log("ğŸ“Š Initializing Chart.js charts..."),window.chartsInitialized=!0,function initializeCharts(){const t={responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1a2847",bodyColor:"#6b7280",borderColor:"rgba(42, 123, 160, 0.3)",borderWidth:1,cornerRadius:8,displayColors:!1,padding:12}},scales:{x:{grid:{color:"rgba(255, 255, 255, 0.1)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.7)",maxRotation:45,minRotation:45,font:{size:window.innerWidth<400?9:11},autoSkip:!0,maxTicksLimit:window.innerWidth<768?6:12}},y:{grid:{color:"rgba(255, 255, 255, 0.1)",drawBorder:!1},ticks:{color:"rgba(255, 255, 255, 0.7)",callback:function(t){return t+"%"},font:{size:window.innerWidth<400?9:11}}}},layout:{padding:{left:0,right:0,top:10,bottom:0}}},n=document.getElementById("inflationChart");if(n){const a=n.getContext("2d");e=new Chart(a,{type:"line",data:{labels:[],datasets:[{data:[],borderColor:"#4ca5ba",backgroundColor:"rgba(76, 165, 186, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:"#b8d4e3",pointBorderColor:"#2a7ba0",pointRadius:4,pointHoverRadius:6}]},options:t})}const o=document.getElementById("hicpChart");if(o){const e=o.getContext("2d");a=new Chart(e,{type:"line",data:{labels:[],datasets:[{data:[],borderColor:"#3891a6",backgroundColor:"rgba(56, 145, 166, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:"#b8d4e3",pointBorderColor:"#1e5a7d",pointRadius:4,pointHoverRadius:6}]},options:{...t,scales:{...t.scales,y:{...t.scales.y,ticks:{...t.scales.y.ticks,callback:function(t){return t.toFixed(0)}}}}}})}console.log("âœ… Charts initialized. Data available:",inflationData.length>0),inflationData.length>0&&(console.log("ğŸ“Š Data was loaded before charts - updating now..."),updateChartsWithData())}()):console.error("âŒ Chart.js not loaded yet when initCharts called")},"undefined"!=typeof Chart?(console.log("âš¡ Chart.js available on page load, initializing immediately"),window.initCharts()):console.log("â³ Chart.js not loaded yet, waiting for lazy load...");let m="cpi",C="cpi";function updateYearlyTable(){const t="cpi"===m?cpiData:inflationData;if(!t||0===t.length)return;const e=function computeYearlyAverages(t){const e={};t.forEach(t=>{const a=t.date.split("-")[0];e[a]||(e[a]=[]),isNaN(t.inflation)||e[a].push(t.inflation)});const a={};return Object.keys(e).forEach(t=>{const n=e[t];a[t]=n.reduce((t,e)=>t+e,0)/n.length}),a}(t);!function renderYearlyTable(t){const e=document.getElementById("yearTableGrid");if(!e)return;const a=Object.keys(t).sort((t,e)=>parseInt(e)-parseInt(t));let n="";a.forEach((e,a)=>{const o=t[e],i=o<0,r=i?'<span class="trend-arrow down">â†“</span>':'<span class="trend-arrow up">â†‘</span>',l=i?"negative":"positive",s=o.toFixed(1).replace(/\.0$/,"").replace(".",","),c=a>=6;n+=`<div class="year-item${c?" older-year":""}"${c?' style="display: none;"':""}><span class="year">${e}</span><span class="value ${l}">${s}% ${r}</span></div>`}),e.innerHTML=n;const o=document.getElementById("showMoreYearsBtn");if(o){const t=a.slice(6);if(t.length>0){const e=o.querySelector(".btn-text");e&&(e.textContent=`NÃ¤ytÃ¤ edelliset vuodet (${t[t.length-1]}â€“${t[0]})`)}}}(e);const a=document.getElementById("yearTableNote");if(a){const e=(new Date).getFullYear(),n=t.filter(t=>t.date.split("-")[0]===e.toString());let o=`LÃ¤hde: ${"cpi"===m?"Tilastokeskus CPI":"Eurostat HICP"}. Luvut edustavat vuosikeskiarvoja.`;n.length>0&&(o+=` ${e} data perustuu ${n.length} kuukauteen.`),a.textContent=o}}function updateKeyMetrics(){const t=function computeMetrics(t){if(!t||0===t.length)return null;const e=t[t.length-1].inflation,a=t.length>=2?t[t.length-2].inflation:null,n=t.length>=13?t[t.length-13].inflation:null,o=t.slice(-12).map(t=>t.inflation).filter(t=>!isNaN(t)),i=o.length>0?o.reduce((t,e)=>t+e,0)/o.length:null,r=(new Date).getFullYear().toString(),l=t.filter(t=>t.date.startsWith(r)).map(t=>t.inflation).filter(t=>!isNaN(t));return{latest:e,monthChange:null!==a?e-a:null,avg12:i,ytdAvg:l.length>0?l.reduce((t,e)=>t+e,0)/l.length:null,yearAgo:n}}("cpi"===C?cpiData:inflationData);if(!t)return;const e=document.querySelectorAll("#tunnusluvut .tile"),a=[t.latest,t.monthChange,t.avg12,t.ytdAvg,t.yearAgo];e.forEach((t,e)=>{if(e>=a.length)return;const n=t.querySelector(".highlight");if(!n)return;const o=a[e];null==o||isNaN(o)?(n.textContent="Ei dataa",n.className="highlight neutral"):(n.textContent=function formatMetricValue(t){return null==t||isNaN(t)?"Ei dataa":`${t>0?"â–² ":t<0?"â–¼ ":""}${t.toFixed(1).replace(".",",")} %`}(o),n.className="highlight "+(o>0?"positive":o<0?"negative":"neutral"))});const n=e[3];if(n){const t=n.querySelector("h3");t&&(t.textContent=`Vuoden ${(new Date).getFullYear()} keskiarvo`)}}function updateInfoBanner(){const t=document.getElementById("infoBannerCPI"),e=document.getElementById("infoBannerHICP");if(t&&cpiData&&cpiData.length>0){const e=cpiData[cpiData.length-1].inflation;t.textContent=`CPI: ${e.toFixed(1).replace(".",",")}%`}if(e&&inflationData&&inflationData.length>0){const t=inflationData[inflationData.length-1].inflation;e.textContent=`HICP: ${t.toFixed(1).replace(".",",")}%`}}const I=document.getElementById("yearTableToggle");I&&I.querySelectorAll("button").forEach(t=>{t.addEventListener("click",function(){I.querySelectorAll("button").forEach(t=>t.classList.remove("active")),this.classList.add("active"),m=this.dataset.source,updateYearlyTable()})});const b=document.getElementById("metricsToggle");function updateInflationChart(){if(!e)return;const t="hicp"===i,a=t?inflationData:cpiData;if(!a||0===a.length)return;const o=a.map(t=>t.date.substr(2)),r=a.map(t=>t.inflation);n={labels:o,datasets:[{label:t?"HICP (Eurostat)":"CPI (Tilastokeskus)",data:r,borderColor:t?"#ff9933":"#4ca5ba",backgroundColor:t?"rgba(255, 153, 51, 0.1)":"rgba(76, 165, 186, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:t?"#ffcc99":"#b8d4e3",pointBorderColor:t?"#cc7a29":"#2a7ba0",pointRadius:3,pointHoverRadius:5}]};const l=document.querySelector("#analytiikka .chart:first-child .chart-controls button[data-range].active"),s=l?l.textContent:"5v";updateChart(e,n,s),updateInflationStats(s)}function updateIndexChart(){if(!a)return;const t="hicp"===r,e=t?inflationData:cpiData;if(!e||0===e.length)return;const n=t?"hicp":"cpi",i=e.map(t=>t.date.substr(2)),l=e.map(t=>t[n]);o={labels:i,datasets:[{label:t?"HICP Index (Eurostat)":"CPI Index (Tilastokeskus)",data:l,borderColor:t?"#ff9933":"#3891a6",backgroundColor:t?"rgba(255, 153, 51, 0.1)":"rgba(56, 145, 166, 0.1)",borderWidth:3,tension:.4,fill:!0,pointBackgroundColor:t?"#ffcc99":"#b8d4e3",pointBorderColor:t?"#cc7a29":"#1e5a7d",pointRadius:3,pointHoverRadius:5}]};const s=document.querySelector("#analytiikka .chart:last-child .chart-controls button[data-range].active"),c=s?s.textContent:"5v";updateChart(a,o,c),updateHicpStats(c)}function updateChartsWithData(){inflationData&&0!==inflationData.length||cpiData&&0!==cpiData.length?(console.log("ğŸ“Š Updating charts with",inflationData.length,"HICP data points,",cpiData.length,"CPI data points"),updateInflationChart(),updateIndexChart()):console.log("No data to update charts")}b&&b.querySelectorAll("button").forEach(t=>{t.addEventListener("click",function(){b.querySelectorAll("button").forEach(t=>t.classList.remove("active")),this.classList.add("active"),C=this.dataset.source,updateKeyMetrics()})}),fetchInflationData(),window.STATIC_DATA_AVAILABLE?console.log("â° Auto-refresh disabled (using static data)"):(setInterval(fetchInflationData,CONFIG.CACHE_DURATION),console.log("â° Auto-refresh enabled (API mode)")),window.addEventListener("scroll",()=>{const t=document.querySelector(".navbar");window.scrollY>50?t.classList.add("scrolled"):t.classList.remove("scrolled")})});